<h3>
    Filters <span 
        class="sup-icon" 
        data-toggle="tooltip" 
        title="Click on a filter label to expand it and see the sub-filters. Click on 'Add all' to apply all the sub-filters or click on the sub-filter label to only apply that. The number in the badge indicates how many records are available if that filter is applied.">
        {% include "svgs/solid/info-circle.svg" %}
    </span>
</h3>

<div id="filters" class="mb-2">
    <div
        v-for="facet in facets"
        :key="facet.name"
        class="btn-group"
        role="group"
        aria-label="Grouped filters">
        <button
            v-bind:aria-controls="facet.name" 
            v-bind:class="hasFilter([facet.name]) ? 'btn-info' : ''"
            v-bind:data-target="'#' + facet.name"
            aria-expanded="false"
            class="btn btn-outline-primary btn-sm toggler"
            data-toggle="collapse"
            type="button">
            {[ getFacetDisplayName(facet.name) ]} 
        </button>
        <button
            v-if="hasAny(facet)"
            v-on:click="updateFilters([facet.name, 'any'])"
            v-bind:class="hasFilter([facet.name, 'any']) ? 'btn-info btn-sm' : 'btn-outline-dark btn-sm'"
            class="btn btn-outline-primary btn-sm"
            type="button">Add all
            <span class="badge badge-secondary">{[ getFacetCount(facet.buckets) ]}</span>
            <span class="sr-only">records</span>
        </button>
        <button
            v-if="facet.range"
            class="btn btn-outline-dark btn-sm"
            type="button">{[ facet.display[0] ]}â€“{[ facet.display[1] ]}
        </button>
    </div>

    <div
        v-for="facet in facets"
        :key="facet.name + 'buckets'"
        v-bind:id="facet.name"
        class="alert collapse"
        data-parent="#filters">
        <template v-if="facet.range">
            <bar-chart
                :chart-data="facet.chartData"
                :height="50"
                :click-handler="handleChartClick"></bar-chart>
            <vue-slider
                :data="facet.buckets"
                :data-label="'key'"
                :data-value="'key'"
                :interval="50"
                :marks="true"
                :hide-label="true"
                :tooltip="'always'"
                @drag-end="rangeSearch"
                v-model="query_dates"></vue-slider>
        </template>
        <template v-else>
            <template v-for="bucket in facet.buckets">
                <button
                    v-if="getBucketValue(bucket) !== 'any'"
                    v-on:click="updateFilters([facet.name, getBucketValue(bucket)])"
                    v-bind:class="hasFilter([facet.name, getBucketValue(bucket)]) ? 'btn-info btn-sm' : 'btn-outline-dark btn-sm'"
                    class="filter btn"
                    type="button">
                    {[ getBucketValue(bucket) ]} 
                    <span class="badge badge-secondary">{[ bucket.doc_count ]}</span>
                    <span class="sr-only">records</span>
                </button>
            </template>
        </template>
    </div>
</div>
